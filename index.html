<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>

</head>
<body>
<a id="yes">test</a>
<form onsubmit="set(); return false">
    <label for="number">Number of account</label>
    <input id="number" type="number" min="2" max="5" step="1">
    <input type="submit">
</form>
</body>
</html>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>
<script>
    function set(){
        document.cookie = "token=separator"
        document.cookie = "visits="+(parseInt(document.getElementById("number").value)-1).toString()
        const logout = window.open("https://open.spotify.com/logout", "Logout", 'width=700,height=500,top=40,left=40')
        setTimeout(function (){window.open("https://accounts.spotify.com/authorize?client_id=bc084485fa444ce39a61f281c1ecaf59&response_type=token&redirect_uri=https%3A%2F%2Fkbelak%2Egithub%2Eio")
            document.getElementById("yes").innerHTML = "test"
            logout.close()
        }, 1000)
    }
    if (document.cookie.includes("visits")){
        if (parseInt(document.cookie.slice(-1)) > 0){
            const logout = window.open("https://open.spotify.com/logout", "Logout", 'width=700,height=500,top=40,left=40')
            setTimeout(function (){
                logout.close()
                window.open("https://accounts.spotify.com/authorize?client_id=bc084485fa444ce39a61f281c1ecaf59&response_type=token&redirect_uri=https%3A%2F%2Fkbelak%2Egithub%2Eio")
                var params = window.location.toString().substring(26)
                var token = {}
                var done = true
                while (done) {
                    var key = params.substring(0, params.indexOf("="))
                    params = params.substring(params.indexOf("=")+1)
                    token[key] = params.substring(0, params.indexOf("&"))
                    if (params. indexOf("=") > -1){
                        params = params.substring(params.indexOf("&")+1)
                    } else {
                        done = false
                        token[key] = params.substring(0)
                    }}
                console.log(token)
                document.cookie = "token="+document.cookie.substring(6, document.cookie.indexOf(";"))+token["access_token"]+"separator"
                document.cookie = "visits="+(parseInt(document.cookie.slice(-1))-1).toString()
                console.log(document.cookie)
            }, 1000)
        } else {
            document.getElementById("yes").innerHTML = "done"
            jQuery.ajax({type: "Post", url: "http://localhost:5000/token?token="+document.cookie.substring(6, document.cookie.indexOf(";")-1), success: function (data){console.log(data)}})
            const logout = window.open("https://open.spotify.com/logout", "Logout", 'width=700,height=500,top=40,left=40')
            setTimeout(function (){
                logout.close()
                document.cookie = "tokens=no; visits=no; expires=Thu, 01 Jan 1970 00:00:00 UTC"
                console.log(document.cookie)
            }, 1000)

        }
    } else {
        document.getElementById("yes").innerHTML = "test"
        document.cookie = "tokens=no; visits=no; expires=Thu, 01 Jan 1970 00:00:00 UTC"
    }
</script>
